---
title: "Dental Data Pack"
subtitle:  "National"
author: "`r paste(format(Sys.time(), '%B, %Y'), ' - Reporting up to end of', format(Sys.Date() - lubridate::weeks(4), '%B, %Y'))`"
output:
  beamer_presentation:
    slide_level: 2
    toc: true
    includes:
      in_header: slide_format2.tex
  slidy_presentation: default
sansfont: Calibri Light
fontsize: 8pt
classoption: aspectratio = 169
##always_allow_html: true
---


```{r libraries, include = FALSE}
library(tidyverse)
library(readxl)
library(DBI)
library(odbc)
library(reactable)
library(downloadthis)
library(lubridate)
library(knitr)
library(ggrepel)
library(ggpubr)
options(htmltools.dir.version = FALSE, htmltools.preserve.raw = FALSE)
options(knitr.duplicate.label = 'allow')

#source in all file 
source(knitr::purl("SQLpulls.Rmd", output = tempfile()))
source(knitr::purl("Data_Processing.Rmd", output = tempfile()), local = TRUE)
source(knitr::purl("plotting.Rmd", output = tempfile()), local = TRUE)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# UDA Information

## Units of Dental Activity - Calendar activity data standardised by working days

```{r UDA_activity_Calendar2, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_delivery_wd(data = UDA_calendar_data,
                                             level = "National",
                                             region_STP_name = NULL)
```

* This graph shows, for each month the percentage of UDAs delivered for that month compared to the expected delivery. Expected monthly delivery is standardised by working days in the month and calculated as Target UDAs* Monthly working days/working days per year.
* For the previous financial years, annual average performance is shown.
* The most recent two months data are incomplete and subject to change, particularly for the most recent month. We expect final data to be higher.
* Contracts included: GDS/PDS/PDS+ where Total contracted UDA>100.



## Units of Dental Activity - Calendar year to date delivery

```{r YTD UDA, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_calendar_data, 
                          UDAorUOA = "UDA", 
                          level = "National", 
                          region_STP_name = NULL, 
                          plotChart = TRUE, 
                          all_regions_and_STPs = FALSE)
```
* This graph shows the progress towards delivering against contracted UDAs in the financial year. Here, expected delivery assumes delivery is equal across all months.

## Banded courses of treatment standardised by working days (included FD)
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align="center"}
plot_banded_CoT(data = UDA_calendar_data_FD, 
                level = "National", 
                region_STP_name = NULL, 
                asIndex = FALSE)
```
* This graph shows the number of completed Courses of Treatment (CoTs) by band over time. Data has been standardised to working days to remove variation due to month length. It is calculated as UDAs* Monthly working days/working days per year.

## Banded Courses of Treatment as % of February 2020 delivery (included FD)
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_banded_CoT(data = UDA_calendar_data_FD, 
                level = "National", 
                region_STP_name = NULL, 
                asIndex = TRUE)
```
* This graph shows time series on the the number of completed Courses of Treatment (CoTs) by band compared to pre-covid delivery.


# UOA Information

## UOA activity - treatment data standardised by working days

```{r UOA_activity_Calendar1, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
# plot_historic_UOA_delivery_wd(data = UOA_calendar_data,
#                                              level = "National",
#                                              region_STP_name = NULL)
```
* Data not yet available in calendar format
 

## YTD UOA delivery
```{r YTD UOA, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
# plot_YTD_UDA_UOA_delivery(data = UOA_calendar_data, 
#                           UDAorUOA = "UOA", 
#                           level = "National", 
#                           region_STP_name = NULL, 
#                           all_regions_and_STPs = FALSE)
```
* Data not yet available in calendar format

# 111 Information

## 111 triage dental related call volumes

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_111_referrals()
```
* This chart shows the demand for dental services via calls to 111.

# Dental Care Practitioners (DCPs) Information

## Percentage of total Courses of Treatment (CoTs) delivered which had DCP assistance

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_DCP_analysis(data = UDA_calendar_data,
                              dcp_data = DCP_data, 
                              UDA_or_FP17 = "FP17",
                              level = "National",
                              region_STP_name = NULL)
```
* This graph shows the percentage of UDAs carried out which benefited from assistance by Dental Care Practitioners.DCP data has been collected since October 2022 so will likely take time for providers to improve reporting on it.

## Percentage of total UDAs delivered which had DCP assistance by band

```{r  echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_DCP_analysis_band(data = UDA_calendar_data,
                              dcp_data = DCP_data,
                              UDA_or_FP17 = "UDA",
                              level = "National",
                              region_STP_name = NULL)

```
* This chart shows the percentage of UDAs carried out which benefited from assistance by Dental Care Practitioners by treatment band. DCP data has been collected since October 2022 so will likely take time for providers to improve reporting on it.



# Unique patients

## Unique dental patients seen

```{r unique patients, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_unique_patients_rolling(level = "National", 
                             plotChart = TRUE, 
                             all_regions_and_STPs = FALSE, 
                             asIndex = FALSE)
```
*Include definition +++++++
* Contracts included: GDS/PDS/PDS+
* The most recent two months data will be incomplete and subject to change, particularly for the most recent month. We expect final data to be higher.

## Unique dental patients seen as a percentage of February 2020 figures

```{r unique patients percentage, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_unique_patients_rolling(level = "National", 
                             plotChart = TRUE, 
                             all_regions_and_STPs = FALSE, 
                             asIndex = TRUE)
```
